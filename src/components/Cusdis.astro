---
interface Props {
  pageId: string;
  pageTitle: string;
  pageUrl: string;
  lang?: "nl" | "en";
}

const { pageId, pageTitle, pageUrl, lang = "nl" } = Astro.props;

const APP_ID = "d5c623e8-37b9-44d2-87a6-a10fbcd900dc";
---

<section
  class="comments"
  style="margin-top: 48px; padding: 24px; background: var(--surface, #f9f9f9); border-radius: 8px;"
>
  <h2 style="margin-bottom: 24px; font-size: 1.25em;">
    {lang === "nl" ? "Reacties" : "Comments"}
  </h2>

  <div
    id="cusdis_thread"
    data-host="https://cusdis.com"
    data-app-id={APP_ID}
    data-page-id={pageId}
    data-page-url={pageUrl}
    data-page-title={pageTitle}
    data-theme="auto"
  >
  </div>

  <style>
    #cusdis_thread iframe {
      width: 100% !important;
      height: auto !important;
      min-height: 300px !important;
      border: none !important;
      overflow: visible !important;
    }
  </style>

  <script is:inline async defer src="https://cusdis.com/js/cusdis.es.js"></script>

  <!-- Auto-resize iframe based on content -->
  <script is:inline>
    (function() {
      const checkIframe = setInterval(function() {
        const iframe = document.querySelector('#cusdis_thread iframe');
        if (iframe) {
          clearInterval(checkIframe);
          iframe.style.height = '500px';
          
          // Listen for resize messages from Cusdis
          window.addEventListener('message', function(e) {
            if (e.origin === 'https://cusdis.com' && e.data && typeof e.data.height === 'number') {
              iframe.style.height = (e.data.height + 50) + 'px';
            }
          });
        }
      }, 100);
    })();
  </script>

  <p style="margin-top: 16px; font-size: 0.85em; color: var(--muted);">
    {
      lang === "nl"
        ? "Reacties worden gemodereerd. Geen juridisch advies."
        : "Comments are moderated. No legal advice."
    }
  </p>
</section>
