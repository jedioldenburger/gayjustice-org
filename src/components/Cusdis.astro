---
interface Props {
  pageId: string;
  pageTitle: string;
  pageUrl: string;
  lang?: "nl" | "en";
}

const { pageId, pageTitle, pageUrl, lang = "nl" } = Astro.props;

const APP_ID = "d5c623e8-37b9-44d2-87a6-a10fbcd900dc";
---

<section
  class="comments"
  style="margin-top: 48px; padding: 24px; background: var(--surface, #f9f9f9); border-radius: 8px;"
>
  <h2 style="margin-bottom: 24px; font-size: 1.25em;">
    {lang === "nl" ? "Reacties" : "Comments"}
  </h2>

  <div
    id="cusdis_thread"
    data-host="https://cusdis.com"
    data-app-id={APP_ID}
    data-page-id={pageId}
    data-page-url={pageUrl}
    data-page-title={pageTitle}
    data-theme="auto"
  >
  </div>

  <script is:inline async defer src="https://cusdis.com/js/cusdis.es.js"
  ></script>

  <!-- Auto-resize iframe to fit content -->
  <script is:inline>
    window.addEventListener('message', function(e) {
      if (e.data && e.data.from === 'cusdis') {
        const iframe = document.querySelector('#cusdis_thread iframe');
        if (iframe && e.data.event === 'resize') {
          iframe.style.height = e.data.data + 'px';
        }
      }
    });
  </script>

  <p style="margin-top: 16px; font-size: 0.85em; color: var(--muted);">
    {
      lang === "nl"
        ? "Reacties worden gemodereerd. Geen juridisch advies."
        : "Comments are moderated. No legal advice."
    }
  </p>
</section>
